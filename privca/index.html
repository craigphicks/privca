



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Step by step guide to issuing private certs for Server and Client Side Authentication - specifically *lighttpd* and *Firefox*">
      
      
        <link rel="canonical" href="https://craigphicks.github.io/privca/privca/">
      
      
        <meta name="author" content="Craig Hicks">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.0.2">
    
    
      
        <title>Privca - Server/Client 2-way Authentication w/ Private CA</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.982221ab.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.1f0bcf2b.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
      <link rel="manifest" href="../manifest.webmanifest">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#privca-usage-description" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://craigphicks.github.io/privca" title="Server/Client 2-way Authentication w/ Private CA" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Server/Client 2-way Authentication w/ Private CA
            </span>
            <span class="md-header-nav__topic">
              Privca
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://craigphicks.github.io/privca" title="Server/Client 2-way Authentication w/ Private CA" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Server/Client 2-way Authentication w/ Private CA
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Privca
      </label>
    
    <a href="./" title="Privca" class="md-nav__link md-nav__link--active">
      Privca
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#privca-usage-description" title="privca usage description" class="md-nav__link">
    privca usage description
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#privca-createca" title="privca CreateCA" class="md-nav__link">
    privca CreateCA
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#privca-createserver" title="privca CreateServer" class="md-nav__link">
    privca CreateServer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#priv-createclient" title="priv CreateClient" class="md-nav__link">
    priv CreateClient
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#privca-usage-description" title="privca usage description" class="md-nav__link">
    privca usage description
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#privca-createca" title="privca CreateCA" class="md-nav__link">
    privca CreateCA
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#privca-createserver" title="privca CreateServer" class="md-nav__link">
    privca CreateServer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#priv-createclient" title="priv CreateClient" class="md-nav__link">
    priv CreateClient
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Privca</h1>
                
                <!-- privca-man -->

<p>Step by step usage example is <a href="../#making-certs">here</a>.</p>
<h2 id="privca-usage-description"><em>privca</em> usage description<a class="headerlink" href="#privca-usage-description" title="Permanent link">&para;</a></h2>
<p>To keep user required actions to a minumum, the simple bash script <em>privca</em> satisfies the following conditions:</p>
<ul>
<li>No configuration files are used, minimal command line parameters only.</li>
<li>Two levels of certificates only, no intermediate certificates.</li>
<li>Certificate file names correspond to their certificate "Common names", and leaf "common names" include their CA "common names"</li>
</ul>
<p>The program must be executed in the directory which will be used for certificate storage.<br />
Typically the directory would have the same name as the root CA common name.
The certificate file owner will be set the program executor.
All calls should made by the same executor, e.g., all as user, or all as sudo.</p>
<h5 id="privca-createca">privca CreateCA<a class="headerlink" href="#privca-createca" title="Permanent link">&para;</a></h5>
<p><strong>privca CreateCA &lt;<em>CA common name</em>&gt; &lt;<em>CA organization name</em>&gt;</strong></p>
<ul>
<li>Only one CA is allowed per directory.</li>
<li>No password is used for the CA private key.  To enable it, modify the <em>privca</em> source to remove argument <em>-nodes</em> in the call to <em>openssl</em> in the function <code>CreateCA</code>.</li>
<li><strong>&lt;<em>CA common name</em>&gt;</strong> will be the CA common name parameter, which will also be used in the file name.  No spaces or non-filename characters should be used.</li>
<li><strong>&lt;<em>CA organization name</em>&gt;</strong> is only used as a category index by the Firefox browser.  If you create multiple CA's and always use the same CA organization name, then the various CA's with different common names will appear together under the shared organization name in the browser's <em>Authorities</em> list.</li>
<li>The following files will be created:<ul>
<li><strong>&lt;<em>Server common name</em>&gt;.key</strong> : the CA private key</li>
<li><strong>&lt;<em>Server common name</em>&gt;.crt</strong> : the CA public cert</li>
</ul>
</li>
</ul>
<h5 id="privca-createserver">privca CreateServer<a class="headerlink" href="#privca-createserver" title="Permanent link">&para;</a></h5>
<p><strong>privca CreateServer &lt;<em>Server common name</em>&gt; &lt;<em>subjectAltNames</em>&gt;</strong></p>
<ul>
<li>The CA must have been already created.  It will be used.</li>
<li><strong>&lt;<em>Server common name</em>&gt;</strong> will be the sever common name parameter, and that will also be used in the filename.  No spaces or non-filename character should be used.</li>
<li><strong>&lt;<em>subjectAlNames</em>&gt;</strong> will be the <code>subjectAltNames</code> field in the certificate.  This is set to the the addresses that will appear in the browser bar, e.g., <code>DNS:pihole.home.lan,DNS:pihole,IP:192.168.1.20</code>.</li>
<li>The following files will be created:<ul>
<li><strong>&lt;<em>Server common name</em>&gt;.key</strong> : server private key file </li>
<li><strong>&lt;<em>Server common name</em>&gt;.crt</strong> : server public cert</li>
<li><strong>&lt;<em>Server common name</em>&gt;.key-crt.pem</strong> : combined key and cert
  A file <strong>&lt;<em>Server common name</em>&gt;.key-crt.pem</strong> will be created.  This file needs to copied to and configured by the <em>lighttpd</em> server with the <code>ssl.pem-file</code> parameter.  It functions as the server certificate.</li>
</ul>
</li>
</ul>
<h5 id="priv-createclient">priv CreateClient<a class="headerlink" href="#priv-createclient" title="Permanent link">&para;</a></h5>
<p><strong>privca CreateClient &lt;<em>Client common name</em>&gt;</strong></p>
<ul>
<li>The CA must have been already created.  It will be used.</li>
<li><strong>&lt;<em>Client common name</em>&gt;</strong> will be the common name parameter, and that will also be used for the filename. No spaces or non-filename character should be used.</li>
<li>The following files will be created:<ul>
<li><strong>&lt;<em>Client common name</em>&gt;.key</strong> : server private key file </li>
<li><strong>&lt;<em>Client common name</em>&gt;.crt</strong> : server public cert</li>
<li><strong>&lt;<em>Client common name</em>&gt;.pks12</strong> : combined key and cert</li>
</ul>
</li>
</ul>
<p><description markdown=1>
An example final directory tree:</p>
<div class="codehilite"><pre><span></span># tree
.
├── ca
│   ├── private
│   │   └── Root1.key
│   └── public
│       └── Root1.crt
├── export
│   ├── private
│   │   ├── Client1.p12
│   │   └── Server1.key-crt.pem
│   └── public
│       └── Root1.crt -&gt; ./ca/public/Root1.crt
├── private
│   ├── Client1.key
│   └── Server1.key
├── public
│   ├── Client1.crt
│   └── Server1.crt
└── temp
    ├── Client1.csr
    └── Server1.csr

9 directories, 11 files
</pre></div>
                
                  
                
              
              


<!--

<h2 id=comments>Comments are Welcome<h2>

<form>
<script data-isso="https://pindertek.net/isso-2/"
        src="js-isso/embed.dev.js"></script>
<section id="isso-thread"></section>
</form>

-->
    

            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href=".." title="Home" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Home
              </span>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; Craig Hicks 2019
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/craigphicks" class="md-footer-social__link fa fa-github"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.d9aa80ab.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>